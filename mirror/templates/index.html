<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{{ url_for('static', filename= 'css/style.css') }}">
    <title>Info Screen</title>
</head>
<body>
    <div class="top">
        <div class="topText" id="phrase"> bottom text</div>

        <div class='time'>
            <div class="timeHours" id="clock">H:M:S</div>
            <div class="timeDate" id="date">D.M.Y</div>
    
       </div>
    </div>

   <div class="content">

    <div class="unisafka">
        <div class="restaurant-header" id="hertsi-header">Hertsi</div>
        <div class="restaurant" id="hertsi"></div>

        <div class="restaurant-header" id="newton-header">Newton</div>
        <div class="restaurant" id="newton"></div>

        <div class="restaurant-header" id="konehuone-header">Konehuone</div>
        <div class="restaurant" id="konehuone"></div>

        <div class="restaurant-header" id="reaktori-header">Reaktori</div>
        <div class="restaurant" id="reaktori"></div>
    </div>
       
       <div class="rightside">

           <div class="weather">
                <div class="temp" id="now"> weather</div>
                <div class="temp" id="3h"> weather</div>
                <div class="temp" id="6h"> weather</div>
                <div class="temp" id="9h"> weather</div>
                <div class="temp" id="12h"> weather</div>

            </div>
            
            <div class="nysse">
                <div class="nysse-header" id="route">Route</div>
                <div class="departure" >nysse</div>
                <div class="departure" >nysse</div>
                <div class="departure" >nysse</div>
                <div class="departure" >nysse</div>
                <div class="departure" >nysse</div>
            </div>
        </div>
   </div>

   

<script>
    var clock = document.getElementById("clock");
    var date = document.getElementById("date");
    setInterval(() => {
        fetch("{{ url_for('time_feed') }}")
        .then(response => {
                response.text().then(t => {
                    console.log("Data received:",t);
                    var lines = t.split('\n');
                    clock.innerHTML = lines[0];
                    date.innerHTML = lines[1];
                })
            });
        }, 1000);  
</script>
<script>
    // 10 minutes in milliseconds 600000
    var phrase = document.getElementById("phrase");
    setInterval(() => {
        fetch("{{ url_for('phrases')}}")
        .then(response => {
            response.text().then(t => {
                phrase.innerHTML = t
            })
        })
    }, 600000 )
</script>
<script>

    // if sunday, show "closed" for all restaurants
    const today = new Date().getDay();
    if (today == 0) {
        const restaurantElements = document.getElementsByClassName('restaurant');
        for (let i = 0; i < restaurantElements.length; i++) {
            restaurantElements[i].innerHTML = "Closed";
        }
    }

    // check if local storage has been updated today
    const lastExecuted = localStorage.getItem('lastExecuted');
    const timeNow = new Date().getTime();
    const dayMilliSecs = 1000 * 60 * 60 * 24;

    const restaurantName ="";
    const isOpenToday = ""; 
    const eatingHours = "";
    const menuItems = "";

    console.log("Fetching menu data...");
    if(!lastExecuted || timeNow - lastExecuted < dayMilliSecs) {

    fetch("{{ url_for('menu')}}")
        .then(response => response.json())  // Parse JSON response
        .then(data => {
            // Iterate through restaurant data and update HTML elements
            data.forEach(restaurant => {
                const restaurantName = restaurant.name.includes('Konehuone') ? "Konehuone" : restaurant.name;
                const isOpenToday = restaurant.open_today;
                const eatingHours = restaurant.eating_hours;
                const menuItems = restaurant.menu;

                // Update HTML elements with restaurant information
                const restaurantElement = document.getElementById(restaurantName.toLowerCase());
                const restaurantHeaderElement = document.getElementById(restaurantName.toLowerCase() + "-header");
                if (restaurantElement && restaurantHeaderElement) {
                    restaurantHeaderElement.innerHTML =
                    `<strong>${restaurantName}</strong> ${eatingHours}<br>`;

                    restaurantElement.innerHTML = menuItems.map(item => item[1]).join('<br>');
                }   
            });

            // store current time to local storage
            localStorage.setItem('lastExecuted', timeNow);
        })
        .catch(error => {
            console.error("Error fetching menu data:", error);
        });
        

    }
</script>

<script>
    // minute in milliseconds 60000

    
    setInterval(() => {
        fetch("{{ url_for('get_nysse') }}")
        .then(response => response.json())
        .then(data => {
            console.log("Data received:",data);
            // get routes last element
            var route = data.route;
            console.log(route);
            var header = document.getElementById("route");
            header.innerHTML = header;

            //data.departures.forEach((departure, index) => {
            //var departureElement = document.getElementsByClassName("departure")[index];
            //    departureElement.innerHTML = departure;
            //});
            
            })
        
    }, 60000);
</script>


<script>
    // hour in milliseconds 3600000
    setInterval(() => {
        fetch("{{ url_for('get_weather') }}")
        .then(response => response.json())
        .then(data => {
            console.log("Data received:",data);
            var now = document.getElementById("now");
            var three = document.getElementById("3h");
            var six = document.getElementById("6h");
            var nine = document.getElementById("9h");
            var twelve = document.getElementById("12h");

        })
    }, 3600000);
</script>
</body>
</html>